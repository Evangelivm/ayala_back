# Ayala Backend API

Backend API para el Sistema Integral de Gesti√≥n de Maquinarias y Construcci√≥n Ayala, construido con NestJS, Prisma ORM y MySQL.

## üèóÔ∏è Arquitectura

### Stack Tecnol√≥gico

- **Framework**: NestJS 10+
- **ORM**: Prisma
- **Base de Datos**: MySQL 8.0+
- **Validaci√≥n**: Zod DTOs
- **M√≥dulos**: ES6
- **Mensajer√≠a**: Kafka (para integraci√≥n con sistemas externos)
- **Autenticaci√≥n**: JWT (implementable)

### Caracter√≠sticas Principales

- ‚úÖ Sistema de personal normalizado con roles contextuales
- ‚úÖ Cat√°logo de equipos independiente de inventario f√≠sico
- ‚úÖ Reportes master-detail con relaciones de foreign keys
- ‚úÖ Gesti√≥n completa de proyectos con estructura jer√°rquica (Proyectos ‚Üí Etapas ‚Üí Sectores ‚Üí Frentes ‚Üí Partidas)
- ‚úÖ Soporte para subproyectos con estructura independiente
- ‚úÖ Sistema de Gu√≠as de Remisi√≥n Electr√≥nica (GRE) integrado con SUNAT
- ‚úÖ Programaci√≥n t√©cnica para gesti√≥n de viajes y entregas
- ‚úÖ Gesti√≥n de camiones y conductores
- ‚úÖ Control de combustible y vales
- ‚úÖ Dashboard con m√©tricas y an√°lisis
- ‚úÖ Validaci√≥n robusta con Zod DTOs
- ‚úÖ Arquitectura modular escalable
- ‚úÖ API RESTful con documentaci√≥n autom√°tica

## üìä Estructura de Base de Datos

### M√≥dulos y Tablas Principales

#### **Estructura de Proyectos (Jer√°rquica)**

Sistema jer√°rquico de 5 niveles para proyectos principales:

```
Proyecto
  ‚îî‚îÄ‚îÄ Etapa
      ‚îî‚îÄ‚îÄ Sector
          ‚îî‚îÄ‚îÄ Frente
              ‚îî‚îÄ‚îÄ Partida
```

Adicionalmente, soporte para Subproyectos independientes:

```
Subproyecto
  ‚îî‚îÄ‚îÄ Sub-Etapa
      ‚îî‚îÄ‚îÄ Subsector
          ‚îî‚îÄ‚îÄ Subfrente
              ‚îî‚îÄ‚îÄ Subpartida
```

#### **Personal**

Tabla normalizada sin roles predefinidos. Los roles se deducen contextualmente.

```sql
- id_personal (PK)
- nombres, apellidos, dni (UNIQUE)
- telefono, correo, fecha_ingreso
- activo, observaciones
```

#### **Equipos** (Cat√°logo de Servicios)

Diferente de `maquinarias` (inventario f√≠sico).

```sql
- id_equipo (PK)
- tipo_equipo (ENUM: EXCAVADORA, CARGADOR, etc.)
- marca, modelo, descripcion
- unidad, precio_referencial
```

#### **Camiones y Conductores**

```sql
camiones:
- id_camion (PK)
- placa (UNIQUE)
- marca, modelo, a√±o
- dni, nombre_chofer, apellido_chofer
- numero_licencia
- capacidad_tanque, tipo_combustible
```

#### **Gu√≠as de Remisi√≥n Electr√≥nica (GRE)**

Sistema completo de gu√≠as electr√≥nicas integrado con SUNAT:

```sql
guias_remision:
- id_guia (PK)
- serie, numero, tipo_comprobante
- fecha_emision, fecha_inicio_traslado
- datos del cliente/destinatario
- datos del transportista
- datos del conductor
- punto_partida/llegada (ubigeo + direcci√≥n)
- items[], observaciones
- estado_gre, enlaces (PDF, XML, CDR)
- relaci√≥n con proyectos/subproyectos
```

#### **Programaci√≥n T√©cnica**

Gesti√≥n de entregas y viajes programados:

```sql
prog_tecnica:
- id_prog_tecnica (PK)
- identificador_unico (UNIQUE)
- guia_* (datos pre-carga para GRE)
- relaci√≥n con proyecto o subproyecto
- m3, estado
```

#### **Reportes Operadores** (Master-Detail)

```sql
Master: codigo_reporte, fecha, id_proyecto
Personal: id_operador, id_vigia, id_mantero, etc.
Detail: detalle_produccion[]
```

#### **Viajes Eliminaci√≥n** (Master-Detail)

```sql
Master: codigo_reporte, fecha, id_proyecto
Personal: id_responsable, id_operador, id_vigia, etc.
Detail: detalle_viajes[] + detalle_horarios[]
```

#### **√ìrdenes de Compra**

```sql
orden_de_compra:
- id_orden (PK)
- numero (UNIQUE), fecha_emision
- proveedor (RUC, empresa, contacto)
- condiciones, moneda
Detail: detalle_orden_compra[]
```

#### **Empresas y Clientes**

```sql
empresas:
- id_empresa (PK)
- numero_documento, razon_social
- direccion, telefono, email

clientes2025:
- id (PK)
- nombre, ruc, direccion
- datos de facturaci√≥n
```

## üöÄ Instalaci√≥n y Configuraci√≥n

### Prerrequisitos

- Node.js 18+
- MySQL 8.0+
- npm o pnpm

### Instalaci√≥n

```bash
# Clonar dependencias
npm install

# Configurar variables de entorno
cp .env.example .env

# Configurar base de datos en .env (Ejemplo)
DATABASE_URL="mysql://usuario:password@localhost:3306/db"

# Generar cliente Prisma
npx prisma generate

# Ejecutar migraciones (opcional)
npx prisma db push
```

### Ejecuci√≥n

```bash
# Desarrollo
npm run start:dev

# Producci√≥n
npm run start:prod

# Modo watch
npm run start
```

## üì° API Endpoints

### **Base URL**: `http://localhost:3001/api`

### **Informaci√≥n del API**

- `GET /` - Informaci√≥n general del API
- `GET /health` - Estado de salud del sistema

### **Personal** (Normalizado)

- `GET /personal` - Listar personal activo
- `GET /personal/:id` - Obtener personal por ID
- `POST /personal` - Crear nuevo personal
- `PUT /personal/:id` - Actualizar personal
- `DELETE /personal/:id` - Eliminar personal

### **Estructura de Proyectos**

#### Proyectos Principales
- `GET /proyectos` - Listar proyectos
- `GET /proyectos/:id` - Obtener proyecto por ID
- `POST /proyectos` - Crear proyecto
- `PUT /proyectos/:id` - Actualizar proyecto

#### Etapas
- `GET /etapas` - Listar todas las etapas
- `GET /etapas/proyecto/:idProyecto` - Listar etapas por proyecto
- `GET /etapas/:id` - Obtener etapa por ID
- `POST /etapas` - Crear etapa
- `PUT /etapas/:id` - Actualizar etapa

#### Sectores
- `GET /sectores` - Listar todos los sectores
- `GET /sectores/etapa/:idEtapa` - Listar sectores por etapa
- `GET /sectores/:id` - Obtener sector por ID
- `POST /sectores` - Crear sector
- `PUT /sectores/:id` - Actualizar sector

#### Frentes
- `GET /frentes` - Listar todos los frentes
- `GET /frentes/sector/:idSector` - Listar frentes por sector
- `GET /frentes/:id` - Obtener frente por ID
- `POST /frentes` - Crear frente
- `PUT /frentes/:id` - Actualizar frente

#### Partidas
- `GET /partidas` - Listar todas las partidas
- `GET /partidas/frente/:idFrente` - Listar partidas por frente
- `GET /partidas/:id` - Obtener partida por ID
- `POST /partidas` - Crear partida
- `PUT /partidas/:id` - Actualizar partida

### **Estructura de Subproyectos**

Similar a proyectos, con endpoints para:
- `/subproyectos` - Subproyectos
- `/sub-etapas` - Sub-Etapas
- `/subsectores` - Subsectores
- `/subfrentes` - Subfrentes
- `/subpartidas` - Subpartidas

### **Gu√≠as de Remisi√≥n Electr√≥nica (GRE)**

#### API de Facturaci√≥n (Nubefact/SUNAT)
- `POST /gre/generar-guia` - Generar GRE y enviar a SUNAT
- `POST /gre/enviar` - Enviar GRE existente a SUNAT
- `GET /gre/consultar/:serie/:numero` - Consultar estado en SUNAT
- `POST /gre/anular` - Anular GRE en SUNAT

#### CRUD de Gu√≠as (Base de datos local)
- `GET /gre-crud` - Listar gu√≠as con filtros
- `GET /gre-crud/:id` - Obtener gu√≠a por ID
- `GET /gre-crud/numero/ultimo` - Obtener √∫ltimo n√∫mero de gu√≠a
- `POST /gre-crud` - Crear gu√≠a
- `PUT /gre-crud/:id` - Actualizar gu√≠a
- `DELETE /gre-crud/:id` - Eliminar gu√≠a

### **Programaci√≥n T√©cnica**

- `GET /programacion` - Listar programaciones
- `GET /programacion/:id` - Obtener programaci√≥n por ID
- `POST /programacion` - Crear programaci√≥n
- `PUT /programacion/:id` - Actualizar programaci√≥n completa
- `PATCH /programacion/tecnica/:id` - Actualizar solo datos t√©cnicos
- `DELETE /programacion/:id` - Eliminar programaci√≥n

### **Camiones**

- `GET /camiones` - Listar camiones
- `GET /camiones/:id` - Obtener cami√≥n por ID
- `GET /camiones/placa/:placa` - Buscar por placa
- `POST /camiones` - Crear cami√≥n
- `PUT /camiones/:id` - Actualizar cami√≥n
- `DELETE /camiones/:id` - Eliminar cami√≥n

### **Empresas**

- `GET /empresas` - Listar empresas
- `GET /empresas/:id` - Obtener empresa por ID
- `GET /empresas/documento/:numeroDocumento` - Buscar por documento
- `POST /empresas` - Crear empresa
- `PUT /empresas/:id` - Actualizar empresa
- `DELETE /empresas/:id` - Eliminar empresa

### **Equipos** (Cat√°logo)

- `GET /equipos` - Listar equipos
- `GET /equipos?tipo_equipo=EXCAVADORA` - Filtrar por tipo
- `GET /equipos/:id` - Obtener equipo por ID
- `POST /equipos` - Crear equipo
- `PUT /equipos/:id` - Actualizar equipo

### **Maquinarias** (Inventario F√≠sico)

- `GET /maquinaria` - Listar maquinarias
- `GET /maquinaria/:id` - Obtener maquinaria por ID
- `POST /maquinaria` - Crear maquinaria

### **Reportes Operadores**

- `GET /reportes-operadores` - Listar reportes con filtros
- `GET /reportes-operadores/:id` - Obtener reporte por ID
- `POST /reportes-operadores` - Crear reporte (master + detail)
- `PATCH /reportes-operadores/:id` - Actualizar reporte
- `DELETE /reportes-operadores/:id` - Soft delete

### **Reportes Plantilleros**

- `GET /reportes-plantilleros` - Listar reportes
- `GET /reportes-plantilleros/:id` - Obtener reporte por ID
- `POST /reportes-plantilleros` - Crear reporte
- `PATCH /reportes-plantilleros/:id` - Actualizar reporte

### **Viajes Eliminaci√≥n**

- `GET /viajes-eliminacion` - Listar viajes con filtros
- `GET /viajes-eliminacion/:id` - Obtener viaje por ID
- `POST /viajes-eliminacion` - Crear viaje (master + detail)
- `PATCH /viajes-eliminacion/:id` - Actualizar viaje

### **Dashboard**

- `GET /dashboard/metricas` - Obtener m√©tricas generales
- `GET /dashboard/estadisticas` - Estad√≠sticas del sistema

## üîß Validaci√≥n y DTOs

### Zod Schemas

Todos los endpoints utilizan validaci√≥n con Zod:

```typescript
// Ejemplo: Personal DTO
export const PersonalSchema = z.object({
  nombres: z.string().min(1).max(100),
  apellidos: z.string().min(1).max(100),
  dni: z.string().length(8),
  telefono: z.string().optional(),
  correo: z.string().email().optional(),
  fecha_ingreso: z.string().datetime(),
  activo: z.boolean().optional().default(true),
});
```

### Tipos de Equipos

```typescript
enum TipoEquipoEnum {
  EXCAVADORA,
  CARGADOR,
  MINICARGADOR,
  MOTONIVELADORA,
  PAVIMENTADORA,
  RODILLO,
  VIBROAPRISIONADOR,
  FLETE_TRANSPORTE,
  COMPRESOR,
  GRUA,
  PLATAFORMA_ELEVADORA,
  SERVICIO_PERSONAL,
  SERVICIO_ESPECIALIZADO,
  HERRAMIENTA_MANUAL,
  EQUIPO_TOPOGRAFIA,
}
```

## üìã Sistema de Gu√≠as de Remisi√≥n Electr√≥nica (GRE)

### Funcionalidad Principal

Sistema completo integrado con SUNAT/Nubefact para la emisi√≥n de Gu√≠as de Remisi√≥n Electr√≥nica seg√∫n normativa peruana.

### Caracter√≠sticas

- ‚úÖ **GRE Remitente**: Cuando el propietario de la mercanc√≠a realiza el traslado
- ‚úÖ **GRE Transportista**: Cuando un tercero transporta la mercanc√≠a
- ‚úÖ **Integraci√≥n SUNAT**: Env√≠o directo a sistemas de facturaci√≥n electr√≥nica
- ‚úÖ **Almacenamiento Local**: Base de datos propia para hist√≥rico y consultas
- ‚úÖ **Generaci√≥n Autom√°tica**: Numeraci√≥n correlativa y validaciones
- ‚úÖ **Relaci√≥n con Proyectos**: Vinculaci√≥n con estructura jer√°rquica de proyectos
- ‚úÖ **Gesti√≥n de Ubigeos**: Sistema de ubicaciones geogr√°ficas (Lima)
- ‚úÖ **Documentos Adjuntos**: Enlaces a PDF, XML y CDR de SUNAT

### Flujo de Trabajo

1. **Programaci√≥n T√©cnica**: Se crea una entrada con datos preliminares del viaje
2. **Creaci√≥n de GRE**: Se genera la gu√≠a con todos los datos requeridos por SUNAT
3. **Env√≠o a SUNAT**: Transmisi√≥n electr√≥nica v√≠a API Nubefact
4. **Confirmaci√≥n**: Recepci√≥n de PDF, XML y CDR (Constancia de Recepci√≥n)
5. **Registro**: Almacenamiento en base de datos local para hist√≥rico

### Datos Requeridos

- Datos del comprobante (serie, n√∫mero, fechas)
- Cliente/Destinatario (RUC, raz√≥n social, direcci√≥n)
- Traslado (motivo, bultos, peso)
- Transporte (tipo, placa, conductor)
- Ubicaciones (punto de partida y llegada con ubigeo)
- Items/Productos a transportar
- Relaci√≥n con proyecto o subproyecto (opcional)

## üèõÔ∏è Arquitectura de Roles Contextuales

### Problema Resuelto

Anteriormente, el sistema ten√≠a roles predefinidos en strings, causando:

- Inconsistencias en datos
- Dificultad para mantener relaciones
- Limitaciones de escalabilidad

### Soluci√≥n Implementada

**Roles Contextuales**: Los roles se deducen del contexto donde aparece el ID de la persona.

```sql
-- Si id_personal = 5 aparece en:
viajes_eliminacion.id_vigia = 5     ‚Üí Persona act√∫a como Vig√≠a
reportes_operadores.id_operador = 5 ‚Üí Persona act√∫a como Operador
```

### Beneficios

- ‚úÖ Flexibilidad: Una persona puede tener m√∫ltiples roles
- ‚úÖ Consistencia: Relaciones de FK garantizan integridad
- ‚úÖ Escalabilidad: F√°cil agregar nuevos roles
- ‚úÖ Trazabilidad: Hist√≥rico completo de asignaciones

## üóÇÔ∏è Estructura Jer√°rquica de Proyectos

### Arquitectura de 5 Niveles

El sistema soporta dos estructuras jer√°rquicas paralelas e independientes:

#### Proyectos Principales
```
Proyecto
  ‚îî‚îÄ‚îÄ Etapa (por proyecto)
      ‚îî‚îÄ‚îÄ Sector (por etapa)
          ‚îî‚îÄ‚îÄ Frente (por sector)
              ‚îî‚îÄ‚îÄ Partida (por frente)
```

#### Subproyectos
```
Subproyecto
  ‚îî‚îÄ‚îÄ Sub-Etapa (por subproyecto)
      ‚îî‚îÄ‚îÄ Subsector (por sub-etapa)
          ‚îî‚îÄ‚îÄ Subfrente (por subsector)
              ‚îî‚îÄ‚îÄ Subpartida (por subfrente)
```

### Beneficios

- ‚úÖ **Organizaci√≥n Clara**: Estructura l√≥gica de trabajos y tareas
- ‚úÖ **Trazabilidad**: Cada entrega o reporte se vincula a la estructura completa
- ‚úÖ **Flexibilidad**: Soporte para proyectos grandes y peque√±os
- ‚úÖ **Independencia**: Subproyectos con su propia jerarqu√≠a
- ‚úÖ **Consultas Eficientes**: Filtrado por cualquier nivel de la jerarqu√≠a

## üóÑÔ∏è Gesti√≥n de Base de Datos

### Prisma Commands

```bash
# Ver estado actual
npx prisma status

# Aplicar cambios al schema
npx prisma db push

# Generar cliente despu√©s de cambios
npx prisma generate

# Abrir Prisma Studio
npx prisma studio

# Reset completo (‚ö†Ô∏è CUIDADO)
npx prisma db push --force-reset
```

### Backups

```bash
# Crear backup
mysqldump -u usuario -p ayala_db > backup_$(date +%Y%m%d).sql

# Restaurar backup
mysql -u usuario -p ayala_db < backup_20241222.sql
```

## üß™ Testing

```bash
# Tests unitarios
npm run test

# Tests e2e
npm run test:e2e

# Coverage
npm run test:cov
```

## üì¶ Estructura del Proyecto

```
src/
‚îú‚îÄ‚îÄ app.module.ts                 # M√≥dulo principal
‚îú‚îÄ‚îÄ app.service.ts                # Informaci√≥n del API
‚îú‚îÄ‚îÄ app.controller.ts             # Rutas principales
‚îú‚îÄ‚îÄ dto/                          # Zod validation schemas
‚îÇ   ‚îú‚îÄ‚îÄ personal.dto.ts
‚îÇ   ‚îú‚îÄ‚îÄ equipos.dto.ts
‚îÇ   ‚îú‚îÄ‚îÄ reportes.dto.ts
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ controllers/                  # Controladores legacy
‚îÇ   ‚îú‚îÄ‚îÄ reportes-operadores.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ reportes-plantilleros.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ viajes-eliminacion.controller.ts
‚îÇ   ‚îî‚îÄ‚îÄ informe-consumo-combustible.controller.ts
‚îú‚îÄ‚îÄ personal/                     # M√≥dulo Personal
‚îú‚îÄ‚îÄ equipos/                      # M√≥dulo Equipos
‚îú‚îÄ‚îÄ maquinaria/                   # M√≥dulo Maquinarias
‚îú‚îÄ‚îÄ proyectos/                    # M√≥dulo Proyectos
‚îú‚îÄ‚îÄ etapas/                       # M√≥dulo Etapas
‚îú‚îÄ‚îÄ sectores/                     # M√≥dulo Sectores
‚îú‚îÄ‚îÄ frentes/                      # M√≥dulo Frentes
‚îú‚îÄ‚îÄ partidas/                     # M√≥dulo Partidas
‚îú‚îÄ‚îÄ subproyectos/                 # M√≥dulo Subproyectos
‚îú‚îÄ‚îÄ sub-etapas/                   # M√≥dulo Sub-Etapas
‚îú‚îÄ‚îÄ subsectores/                  # M√≥dulo Subsectores
‚îú‚îÄ‚îÄ subfrentes/                   # M√≥dulo Subfrentes
‚îú‚îÄ‚îÄ subpartidas/                  # M√≥dulo Subpartidas
‚îú‚îÄ‚îÄ gre/                          # M√≥dulo Gu√≠as Remisi√≥n Electr√≥nica
‚îÇ   ‚îú‚îÄ‚îÄ gre.controller.ts         # API SUNAT/Nubefact
‚îÇ   ‚îú‚îÄ‚îÄ gre-crud.controller.ts    # CRUD local
‚îÇ   ‚îî‚îÄ‚îÄ gre.service.ts
‚îú‚îÄ‚îÄ programacion/                 # M√≥dulo Programaci√≥n T√©cnica
‚îú‚îÄ‚îÄ camiones/                     # M√≥dulo Camiones
‚îú‚îÄ‚îÄ empresas/                     # M√≥dulo Empresas
‚îú‚îÄ‚îÄ dashboard/                    # M√≥dulo Dashboard
‚îú‚îÄ‚îÄ kafka/                        # M√≥dulo Kafka (mensajer√≠a)
‚îú‚îÄ‚îÄ reportes/                     # M√≥dulo Reportes
‚îú‚îÄ‚îÄ prisma/                       # Prisma ORM
‚îÇ   ‚îú‚îÄ‚îÄ prisma.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ prisma.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma             # Schema de base de datos
‚îî‚îÄ‚îÄ generated/                    # C√≥digo generado por Prisma
    ‚îî‚îÄ‚îÄ prisma/                   # Cliente Prisma
```

## üîÑ Versionado del API

### v3.0.0 (Actual - 2025)

- ‚úÖ Sistema completo de Gu√≠as de Remisi√≥n Electr√≥nica (GRE) integrado con SUNAT
- ‚úÖ Programaci√≥n t√©cnica para gesti√≥n de entregas
- ‚úÖ Estructura jer√°rquica completa de proyectos (5 niveles)
- ‚úÖ Soporte para subproyectos independientes
- ‚úÖ Gesti√≥n de camiones y conductores
- ‚úÖ Dashboard con m√©tricas y an√°lisis
- ‚úÖ M√≥dulo de empresas y clientes
- ‚úÖ Integraci√≥n con Kafka para mensajer√≠a
- ‚úÖ API modular completamente escalable

### v2.0.0 (2024)

- ‚úÖ Sistema de personal normalizado
- ‚úÖ Cat√°logo de equipos independiente
- ‚úÖ Roles contextuales
- ‚úÖ Reportes master-detail
- ‚úÖ Validaci√≥n con Zod DTOs

### v1.0.0 (Legacy)

- ‚ùå Roles como strings
- ‚ùå Equipos mezclados con maquinarias
- ‚ùå Datos denormalizados

## üöÄ Deployment

### Desarrollo

```bash
npm run start:dev
# API disponible en http://localhost:3001
```

### Producci√≥n

```bash
# Build
npm run build

# Start
npm run start:prod
```

### Variables de Entorno

```env
DATABASE_URL="mysql://user:pass@host:port/db"
PORT=3001
NODE_ENV=production
JWT_SECRET=your-secret-key
```

## üìù Changelog

### v3.0.0 - Enero 2025

- Implementaci√≥n completa de Gu√≠as de Remisi√≥n Electr√≥nica (GRE)
- Integraci√≥n con API de facturaci√≥n SUNAT/Nubefact
- Sistema de programaci√≥n t√©cnica para gesti√≥n de viajes
- M√≥dulo de camiones con datos de conductores integrados
- M√≥dulo de empresas y clientes
- Estructura jer√°rquica completa: Proyectos/Subproyectos (5 niveles cada uno)
- Dashboard con m√©tricas y estad√≠sticas
- Integraci√≥n con Kafka para mensajer√≠a
- Mejoras en la arquitectura modular

### v2.0.0 - Diciembre 2024

- Migraci√≥n a arquitectura normalizada
- Implementaci√≥n de roles contextuales
- Separaci√≥n equipos/maquinarias
- Validaci√≥n con Zod DTOs
- Reportes master-detail

### v1.0.0 - Inicial

- API b√°sica con NestJS
- Estructura legacy con strings

## ü§ù Contribuci√≥n

1. Fork del proyecto
2. Crear branch de feature (`git checkout -b feature/nueva-funcionalidad`)
3. Commit cambios (`git commit -m 'Agregar nueva funcionalidad'`)
4. Push al branch (`git push origin feature/nueva-funcionalidad`)
5. Crear Pull Request

## üîå Integraciones

### SUNAT/Nubefact

El sistema se integra con servicios de facturaci√≥n electr√≥nica para:

- Emisi√≥n de Gu√≠as de Remisi√≥n Electr√≥nica (GRE)
- Consulta de estado de comprobantes
- Anulaci√≥n de gu√≠as
- Descarga de documentos (PDF, XML, CDR)

### Kafka

M√≥dulo de mensajer√≠a para integraci√≥n con sistemas externos:

- Eventos de creaci√≥n de gu√≠as
- Sincronizaci√≥n de datos entre sistemas
- Procesamiento as√≠ncrono de tareas

## üõ°Ô∏è Seguridad

### Recomendaciones

- ‚úÖ Usar HTTPS en producci√≥n
- ‚úÖ Configurar CORS apropiadamente
- ‚úÖ Implementar rate limiting
- ‚úÖ Validar todos los inputs con Zod
- ‚úÖ Mantener actualizadas las dependencias
- ‚úÖ Usar variables de entorno para credenciales
- ‚úÖ Implementar JWT para autenticaci√≥n (pr√≥ximamente)

### Variables Sensibles

```env
DATABASE_URL=           # Conexi√≥n a MySQL
JWT_SECRET=             # Secret para tokens (futuro)
NUBEFACT_TOKEN=         # Token API Nubefact
NUBEFACT_RUC=           # RUC de la empresa
KAFKA_BROKERS=          # Brokers de Kafka
```

## üìä M√©tricas y Monitoreo

### Health Check

```bash
curl http://localhost:3001/api/health
```

Respuesta:
```json
{
  "status": "ok",
  "database": "connected",
  "timestamp": "2025-01-22T10:30:00.000Z"
}
```

### Dashboard

El m√≥dulo Dashboard proporciona:

- M√©tricas generales del sistema
- Estad√≠sticas de gu√≠as emitidas
- Reportes de proyectos activos
- An√°lisis de personal y equipos

## üìû Soporte

Para soporte t√©cnico o consultas:

- **Equipo**: Desarrollo Ayala
- **API Base**: `GET /api/` para informaci√≥n general
- **Health Check**: `GET /api/health` para estado del sistema
- **Documentaci√≥n**: Este README y comentarios en c√≥digo

## üîÆ Pr√≥ximas Caracter√≠sticas

- [ ] Sistema de autenticaci√≥n JWT completo
- [ ] M√≥dulo de facturaci√≥n electr√≥nica (facturas y boletas)
- [ ] Reportes avanzados con gr√°ficos
- [ ] Notificaciones en tiempo real
- [ ] Aplicaci√≥n m√≥vil para operadores
- [ ] Integraci√≥n con sistemas de GPS para seguimiento de veh√≠culos
- [ ] Dashboard interactivo con m√°s m√©tricas

---

**¬© 2025 Maquinarias Ayala - Sistema Integral de Gesti√≥n Backend**

*Desarrollado con NestJS ‚Ä¢ Prisma ‚Ä¢ MySQL*
